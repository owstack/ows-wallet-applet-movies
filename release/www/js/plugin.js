"use strict";angular.module("owsWalletPlugin",["gettext","ionic","ngLodash","owsWalletPluginClient","owsWalletPlugin.api","owsWalletPlugin.controllers","owsWalletPlugin.services"]),angular.module("owsWalletPlugin.api",[]),angular.module("owsWalletPlugin.controllers",[]),angular.module("owsWalletPlugin.services",[]),angular.module("owsWalletPlugin").config(function($urlRouterProvider,$stateProvider){$stateProvider.state("home",{url:"/home",controller:"HomeCtrl",templateUrl:"views/home/home.html"}).state("detail",{url:"/detail/:id",controller:"DetailCtrl",templateUrl:"views/detail/detail.html"})}).run(function($rootScope,$state,starterService,$ionicPlatform){$ionicPlatform.ready(function(){$rootScope.$on("$pre.ready",function(event,session){starterService.init(session,function(){$state.go("home")})})}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){console.log("Applet route change start from:",fromState.name||"-"," to:",toState.name)})}),angular.module("owsWalletPlugin").run(["gettextCatalog",function(gettextCatalog){}]),angular.module("owsWalletPlugin.services").service("movieService",function(apiLog,lodash,CBitPay,CSession){var root={},bitpay=new CBitPay("movieStore");bitpay||apiLog.error("Could not create instance of CBitPay");var movies=[{id:"the-avengers",title:"The Avengers",year:"2012",plot:"The Asgardian Loki encounters the Other, the leader of an extraterrestrial race known as the Chitauri. In exchange for retrieving the Tesseract,2 a powerful energy source of unknown potential, the Other promises Loki an army with which he can subjugate Earth...",episode:"The Avengers",likeCount:267,commentCount:186,price:{amount:5,currency:"USD"}},{id:"star-wars",title:"Star Wars",episode:"Episode IV - A New Hope",year:"1977",plot:"Near the orbit of the desert planet Tatooine, a Rebel spaceship is intercepted by the Empire. Aboard, the deadliest Imperial agent Darth Vader and his stormtroopers capture Princess Leia Organa, a secret member of the rebellion. Before her capture, Leia makes sure the astromech R2-D2, along with the protocol droid C-3PO, escapes with stolen Imperial blueprints stored inside and a holographic message for the retired Jedi Knight Obi-Wan Kenobi, who has been living in exile on Tatooine...",likeCount:582,commentCount:267,price:{amount:4,currency:"USD"}},{id:"2001-space-odyssey",title:"2001: A Space Odyssey",episode:"2001: A Space Odyssey",year:"1968",plot:"In an African desert millions of years ago, a tribe of hominids is driven away from its water hole by a rival tribe. They awaken to find a featureless black monolith has appeared before them. Seemingly influenced by the monolith, they discover how to use a bone as a weapon and drive their rivals away from the water hole...",likeCount:9343,commentCount:2067,price:{amount:3,currency:"USD"}}];return root.getMovies=function(){return movies},root.getMovie=function(id){return lodash.find(movies,function(movie){return id==movie.id})},root.buyMovie=function(id){var movie=root.getMovie(id),request={price:movie.price.amount,currency:movie.price.currency};bitpay.createInvoice(request).then(function(invoice){apiLog.debug("Got invoice: "+JSON.stringify(invoice))}).catch(function(error){apiLog.error("Could not get invoice: "+JSON.stringify(error))})},root}),angular.module("owsWalletPlugin.services").service("starterService",function($rootScope,apiLog){var session,root={};return $rootScope.$on("$pre.beforeLeave",function(event,applet){saveData()}),root.data={},root.init=function(sessionObj,cb){session=sessionObj,root.appletName=session.plugin.header.name,cb()},root.getData=function(cb){cb=cb||function(){},session.get("data").then(function(value){cb(null,value)}).catch(function(error){apiLog.error("Failed to read preferences: "+error.message+" ("+error.statusCode+")"),cb(error)})},root.saveData=function(){session.set("data",data),session.flush()},root}),angular.module("owsWalletPlugin.controllers").controller("DetailCtrl",function($rootScope,$scope,apiLog,movieService,CSession){$scope.buyDiabled=!0,$scope.$on("$ionicView.beforeEnter",function(event,data){$scope.movie=movieService.getMovie(data.stateParams.id)}),$rootScope.$on("$pre.openForBusiness",function(event,pluginId){"org.openwalletstack.wallet.plugin.servlet.bitpay"==pluginId&&($scope.buyDiabled=!1)}),$scope.buy=function(id){CSession.getInstance().chooseWallet().then(function(wallet){if(!wallet)return void apiLog.info("User canceled");movieService.buyMovie(id)}).catch(function(error){apiLog.error("Could not choose a wallet: "+JSON.stringify(error))})}}),angular.module("owsWalletPlugin.controllers").controller("HomeCtrl",function($scope,starterService,movieService){$scope.$on("$ionicView.beforeEnter",function(event,data){$scope.appletName=starterService.appletName,$scope.movies=movieService.getMovies()})});